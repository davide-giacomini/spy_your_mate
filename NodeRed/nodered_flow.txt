[{"id":"b5d1af96.0416f8","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"184b4ccc.80b463","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"8a9a8a88.ca1ed","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"af16ca46.f30ab","type":"ui_tab","z":"","name":"Demo","icon":"dashboard"},{"id":"8d2cdc77.495e7","type":"ui_group","z":"","name":"Button","tab":"af16ca46.f30ab","disp":true,"width":"13","collapse":false},{"id":"c3124e2.75b4ab","type":"mqtt-broker","z":"","name":"IoT Challenge 2","broker":"mqtt3.thingspeak.com","port":"1883","clientid":"EwsFHR4iERE3OzUwCzUrEQI","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"ad5dbdbd.5fbc4","type":"ui_group","z":"","name":"RSSI Chart","tab":"d5d66642.c7c8f","disp":true,"width":"25","collapse":false},{"id":"d5d66642.c7c8f","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"ffebd66a.fda688","type":"ui_group","z":"","name":"Chart with integer X axis","tab":"2bd35d06.24dc0a","order":1,"disp":true,"width":"12"},{"id":"2bd35d06.24dc0a","type":"ui_tab","z":"","name":"Chart.js example","icon":"dashboard","order":2},{"id":"83883a66.b2743","type":"file in","z":"b5d1af96.0416f8","name":"Capture file","filename":"/home/user/spy_your_mate/NodeRed/capture2_test_csv_from_wireshark.csv","format":"lines","chunk":false,"sendError":false,"x":370,"y":380,"wires":[["6edd21d.e347a6"]]},{"id":"9d0f9626.885fa","type":"inject","z":"184b4ccc.80b463","name":"Inject","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0","x":210,"y":100,"wires":[[]]},{"id":"d5c58a42.4e9a78","type":"file in","z":"184b4ccc.80b463","name":"Input file","filename":"/home/user/iot-challenge-2/iot-feeds.csv","format":"utf8","chunk":false,"sendError":false,"x":560,"y":100,"wires":[["4f07d5d7.dbf954","1a02418b.ef631e"]]},{"id":"4f07d5d7.dbf954","type":"debug","z":"184b4ccc.80b463","name":"Debug input file","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":940,"y":100,"wires":[]},{"id":"1a02418b.ef631e","type":"csv","z":"184b4ccc.80b463","name":"","sep":",","hdrin":true,"hdrout":"","multi":"mult","ret":"\\n","temp":"","skip":"0","x":570,"y":180,"wires":[["77a7e3a9.2a6bec","c320f398.8a3fe8"]]},{"id":"77a7e3a9.2a6bec","type":"debug","z":"184b4ccc.80b463","name":"Debug after csv parsing","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":950,"y":180,"wires":[]},{"id":"6403f978.d0021","type":"split","z":"184b4ccc.80b463","name":"Split in messages of array = 2","splt":"\\n","spltType":"str","arraySplt":"2","arraySpltType":"len","stream":false,"addname":"","x":550,"y":380,"wires":[["1764ca7.d7d4eb6"]]},{"id":"c320f398.8a3fe8","type":"function","z":"184b4ccc.80b463","name":"Extract subarray of 100 elements","func":"let firstIndex = 0;\nlet cont = true;\n\nmsg.payload.forEach(function (entry) {\n    if (cont === true && entry.code === 7357) {\n        cont = false;\n    }\n    else if (cont === true) {\n        firstIndex++;\n    }\n});\n\nlet subarray = msg.payload.slice(firstIndex, firstIndex+100);\n\nmsg.payload = subarray;\n\nreturn msg;","outputs":1,"noerr":0,"x":580,"y":280,"wires":[["7c42e280.dc9fec","6403f978.d0021"]]},{"id":"7c42e280.dc9fec","type":"debug","z":"184b4ccc.80b463","name":"Debug for extracting subarray","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":970,"y":280,"wires":[]},{"id":"240d83ae.6bc7e4","type":"debug","z":"184b4ccc.80b463","name":"Debug for splitting","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":950,"y":380,"wires":[]},{"id":"1764ca7.d7d4eb6","type":"delay","z":"184b4ccc.80b463","name":"","pauseType":"rate","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":460,"wires":[["8ad0db69.006c08","c31b4bd1.94c5d"]]},{"id":"c31b4bd1.94c5d","type":"debug","z":"184b4ccc.80b463","name":"Debug for one message per minute","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":950,"y":460,"wires":[]},{"id":"a43c6c06.1ab93","type":"mqtt out","z":"184b4ccc.80b463","name":"","topic":"","qos":"","retain":"","broker":"c3124e2.75b4ab","x":930,"y":700,"wires":[]},{"id":"fc0ddc13.f5d21","type":"function","z":"184b4ccc.80b463","name":"Prepare to send via MQTT","func":"let temperature = msg.payload.field1\nlet humidity = msg.payload.field2\nlet RSSI = msg.payload.field5\n\nmsg.topic = \"channels/1712127/publish\"\nmsg.payload = \"field1=\"+temperature+\"&field2=\"+humidity+\"&field5=\"+RSSI+\"&status=MQTTPUBLISH\"\n\nmsg.RSSI = RSSI\n\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":740,"wires":[["a43c6c06.1ab93","1cf86f13.162b41","54315943.7a866"]]},{"id":"8ad0db69.006c08","type":"split","z":"184b4ccc.80b463","name":"Split in single messages","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":550,"y":560,"wires":[["3b9e2f3a.18d12"]]},{"id":"54315943.7a866","type":"debug","z":"184b4ccc.80b463","name":"Debug for MQTT sending","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":930,"y":760,"wires":[]},{"id":"1cf86f13.162b41","type":"function","z":"184b4ccc.80b463","name":"Prepare chart data","func":"msg.topic = \"RSSI\"\nmsg.payload = msg.RSSI\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":880,"wires":[["bbd80cb9.a879b"]]},{"id":"bbd80cb9.a879b","type":"ui_chart","z":"184b4ccc.80b463","name":"RSSI Chart","group":"ad5dbdbd.5fbc4","order":0,"width":"0","height":"0","label":"RSSI chart","chartType":"line","legend":"true","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":true,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"100","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#b15cff","#c5b0d5"],"useOldStyle":false,"x":930,"y":880,"wires":[[],[]]},{"id":"3b9e2f3a.18d12","type":"delay","z":"184b4ccc.80b463","name":"","pauseType":"rate","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"20","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":640,"wires":[["fc0ddc13.f5d21","def4b910.8035d"]]},{"id":"def4b910.8035d","type":"debug","z":"184b4ccc.80b463","name":"Debug for one message per 20 sec","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":950,"y":640,"wires":[]},{"id":"6edd21d.e347a6","type":"csv","z":"b5d1af96.0416f8","name":"","sep":",","hdrin":true,"hdrout":"","multi":"mult","ret":"\\n","temp":"","skip":"0","x":430,"y":500,"wires":[["5728f208.aff43c"]]},{"id":"5728f208.aff43c","type":"function","z":"b5d1af96.0416f8","name":"Prepare ground truth","func":"let data = [];\n\nmsg.payload.forEach(function (entry) {\n    \n    let time = entry[\"Time\"];\n    let person;\n    \n    if (data.length === 0 || ( parseInt(data[data.length-1][\"x\"] / 0.5) < parseInt(time / 0.5))){\n        \n        if (time < 75) {\n        person = 1;\n        }\n        else if (time < 137) {\n            person = 0;\n        }\n        else if (time < 209) {\n            person = 1;\n        }\n        else if (time < 273) {\n            person = 0;\n        }\n        else {\n            person = 1;\n        }\n        \n        let tuple = {\n            \"x\": time,\n            \"y\": person\n        };\n        \n        data.push(tuple);\n    }\n});\n\nmsg.payload = [{\n    \"series\": [\"Ground truth\"],\n    \"data\": [data],\n    \"labels\": [\"time1\"]\n}];\n\nmsg.reset = 1;\n\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":600,"wires":[["cee31d05.2d18f","6663e5ed.71a7b4"]]},{"id":"2a87ad15.1b00f2","type":"debug","z":"b5d1af96.0416f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1030,"y":420,"wires":[]},{"id":"cee31d05.2d18f","type":"ui_chart","z":"b5d1af96.0416f8","name":"","group":"8d2cdc77.495e7","order":0,"width":"0","height":"0","label":"chart","chartType":"line","legend":"true","xformat":"x","interpolate":"step","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":750,"y":600,"wires":[[],[]]},{"id":"dd1e515e.e4cb4","type":"inject","z":"b5d1af96.0416f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":360,"wires":[["83883a66.b2743"]]},{"id":"49c3377b.a87798","type":"file in","z":"b5d1af96.0416f8","name":"Prediction file","filename":"/home/user/spy_your_mate/NodeRed/prediction.csv","format":"lines","chunk":false,"sendError":false,"x":260,"y":760,"wires":[["71374452.010ab4"]]},{"id":"6663e5ed.71a7b4","type":"trigger","z":"b5d1af96.0416f8","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"0","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":680,"y":700,"wires":[["3d63dd95.c001ca"]]},{"id":"71374452.010ab4","type":"csv","z":"b5d1af96.0416f8","name":"","sep":",","hdrin":true,"hdrout":"","multi":"mult","ret":"\\n","temp":"","skip":"0","x":250,"y":840,"wires":[["ce7f95e2.ad45f"]]},{"id":"ce7f95e2.ad45f","type":"function","z":"b5d1af96.0416f8","name":"Prova","func":"msg.prova = 1;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":840,"wires":[[]]},{"id":"3d63dd95.c001ca","type":"function","z":"b5d1af96.0416f8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":780,"wires":[["2a87ad15.1b00f2"]]}]
